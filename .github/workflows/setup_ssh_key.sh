#!/bin/bash
# Copyright 2025, UNSW
# SPDX-License-Identifier: BSD-2-Clause

set -e

mkdir -p ~/.ssh

cat >> ~/.ssh/known_hosts <<\EOF
login.trustworthy.systems ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBD111xPT6mKt1s+wJvXIGwUXaebbM/B1GE7ztMUgKBqySbO/5AXXFUr/xflvSluH3lYG5tTpGwPYbJyHOmnJGLY=
login.trustworthy.systems ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCYZpsSbQVXO1FUK/OLYsHZm8nceROnrb/pOPoZOJjeOesE5JtL0g2c8AXWp8mEJ/8eWCUXD/iVDQs2FN9MGanh1ZgzmU6OyyE050W31owcMEX8pK8PVsHKZCal2YFKBzh5gbTKmFw7cNweXRdu49V9M8K8rc5We3TGU8NVx6c6UTOtZ/jg47t0GNukt7EKeMKlJKjxnaE32ECYhSYAmJ0u1tZQFIYP4Cz8vXcBdujdo2+7OMs5tBDhGFufITg6OQDgBFLEgRmKZCLV+17Qxop/Cp4S/BmGPpid4PfRDpTW9ccYdiuymjmoJpXY6QB+bH++gnQhxOpdfM8vKjJDxsOyUNqh0H20uIn/er6gGIdbLqS1nI/DtmGmbSfRVXBuNKxQMxcBh45MEYxrQp51p9kW/eN5/2YdFYDNSw7/fagfiwmjcKUvsiySeRXZzGu5fRHqZktKXGCFeuA6O4uXx/kqshLdGJ6X0d1Kl4v02S7Jh0pcA8i146/1he1+D4FLpb8=
login.trustworthy.systems ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINn1vg1dwyMuDFVWdUqoIRmOHv9FdbCZ4q+0zDY/xTJN
login.trustworthy.systems ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDSzWm9H9EKxcinJs8qwBP3U89DBAB+aO+0zb30gynjdnTKpoCMh58LFxzWWs3bM6liNQKj2FJ7Bpog1N7qExxB3dwo34xQ1Nt4YYSE8TIgfjHGmcvo81F8mElNJYH8d7r1iFsVQcjrnhUzapMyeSIL5UtAVHcJmxKNLjgUOeP6YrAE8q6e0Ods1dLS0p3K4IA1LMz57gTdeZfld3GJ/LPg/6D7LEcxkPX+KG15Y7J/zc1uE0GuPFfLYY16rCcbY0ezhqqqgCig/PIQPqc12g6m+n2WkSjMDv6XycyedoCORKySfOCCBkmI8BkTmoO7Nlm/tQ8UbGDH+6o5CiP5WjEDvbf6Gm9gBANemfxP6Nkyhf+0HrBTXSKjSYVXe99q6YZOG2TvUiDsR8Y7cdWDukbge2AdSy7aRRGPnKPWk2HkFBXahpHQm/wFft/1DZaurX/Vee2GlsFXCGkog0vWi2COvWcGFTIMPwcSyuoLTc5exoy5zF3tcDsPWagkLSxBxbU=
login.trustworthy.systems ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCRA/W8LVxLFjzPvijygdSw+rPW/EQEG8WoUVcTm5dYXDIhCc0Zxibd19zPb1LQpE2/Ohe+I16iC5glpmFyDfrs=
login.trustworthy.systems ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPYp/3vDMDnHnjtqt5Oqievgz04g/LJ4yEKOlXCu9Yux
tftp.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEj7X6doSoop91gTvBD7L4O7VGwCO5pLNsu5YAGS1L64MJqo+3wTYgFRdMWTM0hL3YN+1sSabJPICJzKk0EJxkg=
vb01.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDhZW6jkDLaoZXD7BxrM4OtPvRwquHqIRXyFA8rFPpA3G6YXc9iOpTZODt2/CNbZXyCbK9RLuWWDCKNv1CR1gJSurb770wzg5Ts0v6J7eEa+B83skeJUIT2i+eFqyuEcPgvmdG5DChRyhaQen8O97wvkNVnT+B6OJvAtwSCCU9KsO0vI7lCF040PCJTXrvSjkIf3unJxDmdUzPIqyyof/m5FipoceL7sBfAXhMQYlRh4LnrC2rmPt1/yKJENSes0y07i0ihN92m/GBnZHViQjQdSYQbb0eySujrpBnj4Z4aXNv9Ao2kCNqBzV/qpo3ROXZk76ELBHpNX80ewLgHdU/x
vb01.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIAsus4NLjozoEisJBBVtcxhRbUTu9UvLARwOyDb6rS9Rd3ooxRG8rPvHAnC8x+eOW0Oxzyb8mEdqwsUUTspbOU=
vb01.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHqUTgA9+HoTE64Z58Gho1dSufLN/bD/0B1M8ee8CVVb
juliab@tftp:~$ vb02 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfc5wBO/+ExXOFxlR/QMvjroN8KAbDT3IovmHLpjWbzCCE4cE9fu5MQKHgPAJ25sfcTtzlRVrw20hQyHQgL/141wQ/XQk3H1vLKRJbrPVHrpoPgpB4gETOCFpUJJRuup5bBdeWIkTTV82F7V+mpQbMYc30DIl7LCmXd20QV8D5KynNjjci35SRGuHxjbBQNfSs1wVUgK1z+Y5elG7OgLXi2IE361ksEm3nbCJkpLZSFGIVHQkPHwsMhwKBZlXhJAgeqLmiE8d4WQoORXPglvSQ8O20McMjHbOMCIPikPWNhkoSD7ekqn2/HReciLw0R7CJ8c2kPuR//K8MxL3wodZ1
vb02.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBD3yksLxJoCzZzvcZkfg2pV1jGGAAOSzEMnP1Q1lB4KoljOf/W5Kw2c1ZLMJYaWzSciaZBkhu96UQIpHBdgBk0M=
vb02.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDMwTySOHEqawSSo3/4et/71KobxIr07UuotW8HoDCk2
vb03.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjLpyMZ4/1Zj8mT7OKtmd3deon/Ta1QLdSajveNb0HcMXtrrFIJfSMf97A3IN+wyK61m5ThxlRnXO/S1E4kLdA84L1Qv94jUE0fpkBKnw4x62eTHas+a5BsD6jUkypsGnsQ5ugW9A5muQyktqGngyk9/Y/hWdQiPP4ovjwjUJYaiBXiFAFSFnw8r2jdZiSCrim2wWB1jy16atTpmppxhsVFbnx3/Jl54VgbLlJFmfhnYwYv2gG5mbHswEV1p4owIVPcMQljYdMjssTqzcw8t32qmDxmpParUtvO0ZquJ8lvwSlA29iSlMj8DVkjNAgg0754ohJ7wSF3zydGwoR0wgr
vb03.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAQsjevofMjx2sOfOA0/tB4tZal21EKrfSXURYajIX5DCCvzHbUFbaJZpopNWPgRasud7HrxlnAcHtwluILMo64=
vb03.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPyhdhYIiJlr8FSpYEwRJzyeqV3aCj1XJ2CldV8HawKk
vb04.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDl4RW2DzRd7rvTGg1Yb6GqXt1nzzZPdKWVSp9z/s6tY17MEUB0DQtu9wox9PxfBPAy1c2YnW33ezrGUKRM1ScieKNEZbnASDBLllcq/CJv+4EnU0vtE9e0VN34FJnnhNyLpHLgMoglBriJtwMRmEP1tiWvrZuNAXlvNLdgGt/QO0uhYSA4weOkObPA/Shc/ZWIA+kKVFRyby4UXgd6EZDUSOmXV4iFt+JVbg50vYVlAz86DFSBCarFu0vUi1QvpWgn0D5NA2+nDcGevGSAl5j7PRPw7bUJ938nTdT5kJM4722QCGw6BuBdkf2ohwFiHqCljOrajccqSg257ZvWF8v9
vb04.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBL2E2jmBDPTxG/A7BPy2WOuIbQIG/k+LrHbxLiLSZWOcdmK1Ui5vpnHesfHADnzkKENNabnNo/MF+RjSnRIK+lk=
vb04.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL88FdPerLun9BVpgRKh/1CaYZnj8XDNMHgXBd96fial
vb05.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8ncTSIQyaA4/ulod1IWnZVLitjcgZ0/mV1iFS5Pefsd0c8dtLCosMCM3mI6Ho1lkF7r4PslYS0v7LE4kz9WhVJYdkjGwOam8Tea3rB1uQX23Mm2qi7UAAATr0ogluy2ApKUiktKJV8vH9MBadkXWiSJov2fxC4TRzB1Z2avCuWpfwIajhfK7+z3st4yZquCI3SnMgDjYcO+YlqNYBIe2Y531CyOIqxm1JIA6Fwdiwkwh8MwNTBNdnphe6Jim7YagPEyAyEHfGgC3qv7NHrWNmIsjceVutM15olKgJj7/zJ6XHrhQ3nGbi04mCPoqgB3SXea2S7BBC+fCSMxy755WB
vb05.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCNkyS10fWrAQNtZ11eP7qOzr34vKwaNQKb+EACaYPrJyLcLfjas4KqKhKU32BYEymOmmaF0at/We5+BMLkZvm4=
vb05.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE05ZXWSDnX/TqvapioEpDnTlRfCDnkaq9HbljpBKon1
vb06.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAuFxDIE1KuTPYjIRO6jhg4SKej81aM/KA7EKe1AqNyd82MEGUceqkXNVm7raEToBAfedsiZPBRdx/0AcniHOxUbfEJSwqbi/z+in3xqJXwEw7qbGz2x1Gt5msi6JAVx56YQEqWGL0e4O1RID8U0AWFs0fM+rlXE6gcaDD0ziRDsBNOYV5SlZSgPxFA2UM9H2FyLL2clpH0sbrF1IMS5+1W0lZlRJU0I5wEzUXiAg+RgIhO5QdOHF88Ry+WIeJYDHkdMqbwPJGVPa5MwOoOKrGIQ4+yVwZSh9BWvkb5eWjbccvFdB+edTwyksqyCT1yrfis9I1qAEoNZyhggX6FRmT
vb06.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCPa0QIHNwb9RgpSPhQuUlE1v4fEKcn0B4lvZ3eOaMhZoPxbFWv5lIGh5ApAJmE+bfnWa6n8M8o4PBr/hmL0Fro=
vb06.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDGcQvfBVc2z544/FLFIEvGXAZ4a/JXiAANAvs4Disw/
vb07.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDgc+xggxpEvTnTi0Ic/TLKkffqhJ+D49VywbIUbP4r3+bCO3uBDJANRiuFg+EMpzgT2BVOwJa5Sa0vyqn8NtROxQOnihBmsZ+qr+NdnDUtjq2Fgv5ZSdD7r3bNyivugVY1S2DDecm5yX49ccgDedKKxILNF8E2AAxhNHS7WhBziF7O5DO5kXGqk2C7wg7eLxoyY4LNJGtdL2wG2ZXwFIDZSWgK2Z4TQ55jAsxr1zfIpmS2DjsRxt89SccqwFI9y3WS92hqnlxnpsFXEY6jgZ8pis/t3SgbXAsCkOG/uRdqI5MsJmxN5+b/vBTWj9iuc/XfH7p/CfLaPBkrek7k3S+v
vb07.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKLLhm5IXL6cIbldf+s0FxEKxLIg63xdTyyFYsZC7SMZzQws5RlGfFvz5fkJTFRY7CcP1vd1gaXw/aKieJx2pBA=
vb07.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIALlH9pXTWGL8pta++ybUmW7tgZ2pYYLhosIdwc7zsAu
vb08.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuzeXRliY1fwd/U4NddrK+D30s7nkx0hPa5x9T6A9jSNBCo/3gLOw8lA81yoA/EKpqTRErcCi+S8GGDSyj0bvcO9MDUhOXC0KZb/Q0K4/snUb1lYW859bwi3BWgnOm5l1oAqxAscXVvvxflZ7g58wciWyv+hMFIhtjmss6ICKFXszFi4PB4QH/rceQkYNf0oy4HQzM+2TJf9NWWXacxXUNfNKp++fzoYhyzW1+2gEeOToKMDR4VpUEt5BHEQaFS24GNqciTMCUuC2nkjYUBKuGA57NDADYWTvThXxsTW3TgzhHiYOqSi05jxKAsgaEz6llG+uquHhByPcJsLODqHLV
vb08.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBE05rEaLBU4OabuECDH+rvaPuLVqHGyTA1Mue+ZAVPTI/XqHG2DVgz36QQj7RKnHR3JxsdsIl+eQr3wDhHBflTA=
vb08.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJ0JKjCx+YxgHBehTH1cgpmIWCDbDcC6xIFR+WQA7Aza
vb09.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDCWpxmKMaonUowEmWoSM2B0fpXiPW9N/5aTueeR9NhSu7CCzRUGkwXhS393Fks1ooUIW+IPKPQ9ASS9sdBz9ed7pvDbXcsXSW595TWoWSDU4wZNb9zFevrHbeKoHsn7RKMynSBORXiZl+XslgBJuP8QJXOmDcq+cuNiM+NWCrt5QJbiODQPEhKljx+9jN7wtwjQgso94KjUdLccc8861+aHkXCXIoxp+DEjb6FLG1bEAvRoaviuZQKMpwDf3sz4FddT//Bl47Tnv62Bj7Kj7ENPQNdycoodNH41u6Eik48CzVTskARBLi80YC2e678G+gAJwDNnSZn6yzWWkzarIgZ
vb09.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJ7Fvaz6tZGmtEuBLsY38LKJZZGcaVGgu7oXFJo1OgJ8PHc19xO6h8ZNVTgcZ9SYTSiSJO/YkFk1FEfhG4juu7E=
vb09.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILacVjWxwGacBm8E+pSBWW20dULns9Ggq+XVccJFzaRX
vb10.keg.cse.unsw.edu.au ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDfhBaTBCajLGQynnV1rutqZhLrZuomRxR6RVICDRV5PeyHXELxpfgofJCtzjWhEWnKx8aTRwF9KD8tZzvi1XwwjdRunBA4nisx9pSXyEANm7/uQERlthLT9FBQyayxucGo9QDa4acx1irkZHoSCoHCXHcdHeGE4gkeLqdgFgFzVXcaSaJOe8RKQQPQHnnQOrbi4eqLvnsgO6+SqUF82+sOtsWNLrDKmEcCLxb9Q3d1XV7pZDowSUtSrMaFwag67t70fJnT9jNzfKpSBNBzA3Hf+eDBhWiv6J5metvk2DAVoLXxHXt27e+cL06tawQdlOr7bFWTzG7rL34x0Ruu7uLF
vb10.keg.cse.unsw.edu.au ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOWz9J5+iUzlDhL3OtDeD9juHSbnJYGVhloUBSsP1mUQHN6UQZTiLLYheXYch2qeighHlv+wLxw+37if4vc1JOQ=
vb10.keg.cse.unsw.edu.au ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICedVECImJ5lDJIlXjbAhnBxcUlUJlNFK7J8/kKJ2gFV
EOF

cat >> ~/.ssh/config <<EOF
Host *
  ServerAliveInterval 30
  ControlMaster auto
  ControlPath ~/.ssh/%r@%h:%p-${GITHUB_RUN_ID}-${GITHUB_JOB}-${INPUT_INDEX}
  ControlPersist 15

Host ts
  Hostname login.trustworthy.systems
  User ts_ci

Host *.keg.cse.unsw.edu.au
  User ts_ci
  ProxyJump ts

EOF

echo "${MACHINE_QUEUE_KEY}" > ~/.ssh/id_ed25519
chmod 600 ~/.ssh/id_ed25519
